// Autogenerated code. Do not modify.
package net.paulgray.lti.contentitem;

import com.fasterxml.jackson.annotation.JsonProperty;
import java.time.Instant;
import java.util.Collection;
import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.Objects;
import java.util.Optional;
import java.util.function.Consumer;
import java.util.function.UnaryOperator;
import javax.annotation.Generated;
import javax.annotation.Nullable;

/**
 * Auto-generated superclass of {@link LtiLinkItem.Builder}, derived from the API of {@link
 * LtiLinkItem}.
 */
@Generated("org.inferred.freebuilder.processor.CodeGenerator")
abstract class LtiLinkItem_Builder {

  /** Creates a new builder using {@code value} as a template. */
  public static LtiLinkItem.Builder from(LtiLinkItem value) {
    return LtiLinkItem.builder().mergeFrom(value);
  }

  private String type;
  private String mediaType;
  // Store a nullable object instead of an Optional. Escape analysis then
  // allows the JVM to optimize away the Optional objects created by and
  // passed to our API.
  private String url = null;
  // Store a nullable object instead of an Optional. Escape analysis then
  // allows the JVM to optimize away the Optional objects created by and
  // passed to our API.
  private String text = null;
  // Store a nullable object instead of an Optional. Escape analysis then
  // allows the JVM to optimize away the Optional objects created by and
  // passed to our API.
  private String title = null;
  // Store a nullable object instead of an Optional. Escape analysis then
  // allows the JVM to optimize away the Optional objects created by and
  // passed to our API.
  private PlacementAdvice placementAdvice = null;
  // Store a nullable object instead of an Optional. Escape analysis then
  // allows the JVM to optimize away the Optional objects created by and
  // passed to our API.
  private Instant expiresAt = null;
  // Store a nullable object instead of an Optional. Escape analysis then
  // allows the JVM to optimize away the Optional objects created by and
  // passed to our API.
  private Image icon = null;
  // Store a nullable object instead of an Optional. Escape analysis then
  // allows the JVM to optimize away the Optional objects created by and
  // passed to our API.
  private Image thumbnail = null;
  private final LinkedHashMap<String, String> custom = new LinkedHashMap<>();

  /**
   * Sets the value to be returned by {@link LtiLinkItem#type()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code type} is null
   */
  @JsonProperty("@type")
  public LtiLinkItem.Builder type(String type) {
    this.type = Objects.requireNonNull(type);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Replaces the value to be returned by {@link LtiLinkItem#type()} by applying {@code mapper} to
   * it and using the result.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null or returns null
   */
  public LtiLinkItem.Builder mapType(UnaryOperator<String> mapper) {
    return type(mapper.apply(type()));
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#type()}. */
  public String type() {
    return type;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#mediaType()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mediaType} is null
   */
  @JsonProperty("mediaType")
  public LtiLinkItem.Builder mediaType(String mediaType) {
    this.mediaType = Objects.requireNonNull(mediaType);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Replaces the value to be returned by {@link LtiLinkItem#mediaType()} by applying {@code mapper}
   * to it and using the result.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null or returns null
   */
  public LtiLinkItem.Builder mapMediaType(UnaryOperator<String> mapper) {
    return mediaType(mapper.apply(mediaType()));
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#mediaType()}. */
  public String mediaType() {
    return mediaType;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#url()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code url} is null
   */
  public LtiLinkItem.Builder url(String url) {
    this.url = Objects.requireNonNull(url);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#url()}.
   *
   * @return this {@code Builder} object
   */
  @JsonProperty("url")
  public LtiLinkItem.Builder url(Optional<? extends String> url) {
    if (url.isPresent()) {
      return url(url.get());
    } else {
      return clearUrl();
    }
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#url()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder nullableUrl(@Nullable String url) {
    if (url != null) {
      return url(url);
    } else {
      return clearUrl();
    }
  }

  /**
   * If the value to be returned by {@link LtiLinkItem#url()} is present, replaces it by applying
   * {@code mapper} to it and using the result.
   *
   * <p>If the result is null, clears the value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null
   */
  public LtiLinkItem.Builder mapUrl(UnaryOperator<String> mapper) {
    return url(url().map(mapper));
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#url()} to {@link Optional#empty()
   * Optional.empty()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearUrl() {
    url = null;
    return (LtiLinkItem.Builder) this;
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#url()}. */
  public Optional<String> url() {
    return Optional.ofNullable(url);
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#text()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code text} is null
   */
  public LtiLinkItem.Builder text(String text) {
    this.text = Objects.requireNonNull(text);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#text()}.
   *
   * @return this {@code Builder} object
   */
  @JsonProperty("text")
  public LtiLinkItem.Builder text(Optional<? extends String> text) {
    if (text.isPresent()) {
      return text(text.get());
    } else {
      return clearText();
    }
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#text()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder nullableText(@Nullable String text) {
    if (text != null) {
      return text(text);
    } else {
      return clearText();
    }
  }

  /**
   * If the value to be returned by {@link LtiLinkItem#text()} is present, replaces it by applying
   * {@code mapper} to it and using the result.
   *
   * <p>If the result is null, clears the value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null
   */
  public LtiLinkItem.Builder mapText(UnaryOperator<String> mapper) {
    return text(text().map(mapper));
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#text()} to {@link Optional#empty()
   * Optional.empty()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearText() {
    text = null;
    return (LtiLinkItem.Builder) this;
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#text()}. */
  public Optional<String> text() {
    return Optional.ofNullable(text);
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#title()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code title} is null
   */
  public LtiLinkItem.Builder title(String title) {
    this.title = Objects.requireNonNull(title);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#title()}.
   *
   * @return this {@code Builder} object
   */
  @JsonProperty("title")
  public LtiLinkItem.Builder title(Optional<? extends String> title) {
    if (title.isPresent()) {
      return title(title.get());
    } else {
      return clearTitle();
    }
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#title()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder nullableTitle(@Nullable String title) {
    if (title != null) {
      return title(title);
    } else {
      return clearTitle();
    }
  }

  /**
   * If the value to be returned by {@link LtiLinkItem#title()} is present, replaces it by applying
   * {@code mapper} to it and using the result.
   *
   * <p>If the result is null, clears the value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null
   */
  public LtiLinkItem.Builder mapTitle(UnaryOperator<String> mapper) {
    return title(title().map(mapper));
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#title()} to {@link Optional#empty()
   * Optional.empty()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearTitle() {
    title = null;
    return (LtiLinkItem.Builder) this;
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#title()}. */
  public Optional<String> title() {
    return Optional.ofNullable(title);
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#placementAdvice()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code placementAdvice} is null
   */
  public LtiLinkItem.Builder placementAdvice(PlacementAdvice placementAdvice) {
    this.placementAdvice = Objects.requireNonNull(placementAdvice);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#placementAdvice()}.
   *
   * @return this {@code Builder} object
   */
  @JsonProperty("placementAdvice")
  public LtiLinkItem.Builder placementAdvice(Optional<? extends PlacementAdvice> placementAdvice) {
    if (placementAdvice.isPresent()) {
      return placementAdvice(placementAdvice.get());
    } else {
      return clearPlacementAdvice();
    }
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#placementAdvice()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder nullablePlacementAdvice(@Nullable PlacementAdvice placementAdvice) {
    if (placementAdvice != null) {
      return placementAdvice(placementAdvice);
    } else {
      return clearPlacementAdvice();
    }
  }

  /**
   * If the value to be returned by {@link LtiLinkItem#placementAdvice()} is present, replaces it by
   * applying {@code mapper} to it and using the result.
   *
   * <p>If the result is null, clears the value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null
   */
  public LtiLinkItem.Builder mapPlacementAdvice(UnaryOperator<PlacementAdvice> mapper) {
    return placementAdvice(placementAdvice().map(mapper));
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#placementAdvice()} to {@link
   * Optional#empty() Optional.empty()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearPlacementAdvice() {
    placementAdvice = null;
    return (LtiLinkItem.Builder) this;
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#placementAdvice()}. */
  public Optional<PlacementAdvice> placementAdvice() {
    return Optional.ofNullable(placementAdvice);
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#expiresAt()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code expiresAt} is null
   */
  public LtiLinkItem.Builder expiresAt(Instant expiresAt) {
    this.expiresAt = Objects.requireNonNull(expiresAt);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#expiresAt()}.
   *
   * @return this {@code Builder} object
   */
  @JsonProperty("expiresAt")
  public LtiLinkItem.Builder expiresAt(Optional<? extends Instant> expiresAt) {
    if (expiresAt.isPresent()) {
      return expiresAt(expiresAt.get());
    } else {
      return clearExpiresAt();
    }
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#expiresAt()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder nullableExpiresAt(@Nullable Instant expiresAt) {
    if (expiresAt != null) {
      return expiresAt(expiresAt);
    } else {
      return clearExpiresAt();
    }
  }

  /**
   * If the value to be returned by {@link LtiLinkItem#expiresAt()} is present, replaces it by
   * applying {@code mapper} to it and using the result.
   *
   * <p>If the result is null, clears the value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null
   */
  public LtiLinkItem.Builder mapExpiresAt(UnaryOperator<Instant> mapper) {
    return expiresAt(expiresAt().map(mapper));
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#expiresAt()} to {@link Optional#empty()
   * Optional.empty()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearExpiresAt() {
    expiresAt = null;
    return (LtiLinkItem.Builder) this;
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#expiresAt()}. */
  public Optional<Instant> expiresAt() {
    return Optional.ofNullable(expiresAt);
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#icon()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code icon} is null
   */
  public LtiLinkItem.Builder icon(Image icon) {
    this.icon = Objects.requireNonNull(icon);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#icon()}.
   *
   * @return this {@code Builder} object
   */
  @JsonProperty("icon")
  public LtiLinkItem.Builder icon(Optional<? extends Image> icon) {
    if (icon.isPresent()) {
      return icon(icon.get());
    } else {
      return clearIcon();
    }
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#icon()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder nullableIcon(@Nullable Image icon) {
    if (icon != null) {
      return icon(icon);
    } else {
      return clearIcon();
    }
  }

  /**
   * If the value to be returned by {@link LtiLinkItem#icon()} is present, replaces it by applying
   * {@code mapper} to it and using the result.
   *
   * <p>If the result is null, clears the value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null
   */
  public LtiLinkItem.Builder mapIcon(UnaryOperator<Image> mapper) {
    return icon(icon().map(mapper));
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#icon()} to {@link Optional#empty()
   * Optional.empty()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearIcon() {
    icon = null;
    return (LtiLinkItem.Builder) this;
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#icon()}. */
  public Optional<Image> icon() {
    return Optional.ofNullable(icon);
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#thumbnail()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code thumbnail} is null
   */
  public LtiLinkItem.Builder thumbnail(Image thumbnail) {
    this.thumbnail = Objects.requireNonNull(thumbnail);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#thumbnail()}.
   *
   * @return this {@code Builder} object
   */
  @JsonProperty("thumbnail")
  public LtiLinkItem.Builder thumbnail(Optional<? extends Image> thumbnail) {
    if (thumbnail.isPresent()) {
      return thumbnail(thumbnail.get());
    } else {
      return clearThumbnail();
    }
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#thumbnail()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder nullableThumbnail(@Nullable Image thumbnail) {
    if (thumbnail != null) {
      return thumbnail(thumbnail);
    } else {
      return clearThumbnail();
    }
  }

  /**
   * If the value to be returned by {@link LtiLinkItem#thumbnail()} is present, replaces it by
   * applying {@code mapper} to it and using the result.
   *
   * <p>If the result is null, clears the value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mapper} is null
   */
  public LtiLinkItem.Builder mapThumbnail(UnaryOperator<Image> mapper) {
    return thumbnail(thumbnail().map(mapper));
  }

  /**
   * Sets the value to be returned by {@link LtiLinkItem#thumbnail()} to {@link Optional#empty()
   * Optional.empty()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearThumbnail() {
    thumbnail = null;
    return (LtiLinkItem.Builder) this;
  }

  /** Returns the value that will be returned by {@link LtiLinkItem#thumbnail()}. */
  public Optional<Image> thumbnail() {
    return Optional.ofNullable(thumbnail);
  }

  /**
   * Associates {@code key} with {@code value} in the map to be returned from {@link
   * LtiLinkItem#custom()}. If the map previously contained a mapping for the key, the old value is
   * replaced by the specified value.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if either {@code key} or {@code value} are null
   */
  public LtiLinkItem.Builder putCustom(String key, String value) {
    Objects.requireNonNull(key);
    Objects.requireNonNull(value);
    custom.put(key, value);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Copies all of the mappings from {@code map} to the map to be returned from {@link
   * LtiLinkItem#custom()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code map} is null or contains a null key or value
   */
  @JsonProperty("custom")
  public LtiLinkItem.Builder putAllCustom(Map<? extends String, ? extends String> map) {
    for (Map.Entry<? extends String, ? extends String> entry : map.entrySet()) {
      putCustom(entry.getKey(), entry.getValue());
    }
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Removes the mapping for {@code key} from the map to be returned from {@link
   * LtiLinkItem#custom()}, if one is present.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code key} is null
   */
  public LtiLinkItem.Builder removeCustom(String key) {
    Objects.requireNonNull(key);
    custom.remove(key);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Invokes {@code mutator} with the map to be returned from {@link LtiLinkItem#custom()}.
   *
   * <p>This method mutates the map in-place. {@code mutator} is a void consumer, so any value
   * returned from a lambda will be ignored. Take care not to call pure functions, like {@link
   * Collection#stream()}.
   *
   * @return this {@code Builder} object
   * @throws NullPointerException if {@code mutator} is null
   */
  public LtiLinkItem.Builder mutateCustom(Consumer<? super Map<String, String>> mutator) {
    // If putCustom is overridden, this method will be updated to delegate to it
    mutator.accept(custom);
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Removes all of the mappings from the map to be returned from {@link LtiLinkItem#custom()}.
   *
   * @return this {@code Builder} object
   */
  public LtiLinkItem.Builder clearCustom() {
    custom.clear();
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Returns an unmodifiable view of the map that will be returned by {@link LtiLinkItem#custom()}.
   * Changes to this builder will be reflected in the view.
   */
  public Map<String, String> custom() {
    return Collections.unmodifiableMap(custom);
  }

  /** Sets all property values using the given {@code LtiLinkItem} as a template. */
  public LtiLinkItem.Builder mergeFrom(LtiLinkItem value) {
    LtiLinkItem_Builder _defaults = LtiLinkItem.builder();
    if (!Objects.equals(value.type(), _defaults.type())) {
      type(value.type());
    }
    if (!Objects.equals(value.mediaType(), _defaults.mediaType())) {
      mediaType(value.mediaType());
    }
    value.url().ifPresent(this::url);
    value.text().ifPresent(this::text);
    value.title().ifPresent(this::title);
    value.placementAdvice().ifPresent(this::placementAdvice);
    value.expiresAt().ifPresent(this::expiresAt);
    value.icon().ifPresent(this::icon);
    value.thumbnail().ifPresent(this::thumbnail);
    putAllCustom(value.custom());
    return (LtiLinkItem.Builder) this;
  }

  /**
   * Copies values from the given {@code Builder}. Does not affect any properties not set on the
   * input.
   */
  public LtiLinkItem.Builder mergeFrom(LtiLinkItem.Builder template) {
    LtiLinkItem_Builder _defaults = LtiLinkItem.builder();
    // Upcast to access private fields; otherwise, oddly, we get an access violation.
    LtiLinkItem_Builder base = template;
    if (!Objects.equals(template.type(), _defaults.type())) {
      type(template.type());
    }
    if (!Objects.equals(template.mediaType(), _defaults.mediaType())) {
      mediaType(template.mediaType());
    }
    template.url().ifPresent(this::url);
    template.text().ifPresent(this::text);
    template.title().ifPresent(this::title);
    template.placementAdvice().ifPresent(this::placementAdvice);
    template.expiresAt().ifPresent(this::expiresAt);
    template.icon().ifPresent(this::icon);
    template.thumbnail().ifPresent(this::thumbnail);
    putAllCustom(base.custom);
    return (LtiLinkItem.Builder) this;
  }

  /** Resets the state of this builder. */
  public LtiLinkItem.Builder clear() {
    LtiLinkItem_Builder _defaults = LtiLinkItem.builder();
    type = _defaults.type;
    mediaType = _defaults.mediaType;
    url = _defaults.url;
    text = _defaults.text;
    title = _defaults.title;
    placementAdvice = _defaults.placementAdvice;
    expiresAt = _defaults.expiresAt;
    icon = _defaults.icon;
    thumbnail = _defaults.thumbnail;
    custom.clear();
    return (LtiLinkItem.Builder) this;
  }

  /** Returns a newly-created {@link LtiLinkItem} based on the contents of the {@code Builder}. */
  public LtiLinkItem build() {
    return new LtiLinkItem_Builder.Value(this);
  }

  /**
   * Returns a newly-created partial {@link LtiLinkItem} for use in unit tests. State checking will
   * not be performed.
   *
   * <p>Partials should only ever be used in tests. They permit writing robust test cases that won't
   * fail if this type gains more application-level constraints (e.g. new required fields) in
   * future. If you require partially complete values in production code, consider using a Builder.
   */
  public LtiLinkItem buildPartial() {
    return new LtiLinkItem_Builder.Partial(this);
  }

  private static final class Value implements LtiLinkItem {
    private final String type;
    private final String mediaType;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final String url;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final String text;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final String title;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final PlacementAdvice placementAdvice;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final Instant expiresAt;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final Image icon;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final Image thumbnail;
    private final Map<String, String> custom;

    private Value(LtiLinkItem_Builder builder) {
      this.type = builder.type;
      this.mediaType = builder.mediaType;
      this.url = builder.url;
      this.text = builder.text;
      this.title = builder.title;
      this.placementAdvice = builder.placementAdvice;
      this.expiresAt = builder.expiresAt;
      this.icon = builder.icon;
      this.thumbnail = builder.thumbnail;
      this.custom = immutableMap(builder.custom);
    }

    @Override
    @JsonProperty("@type")
    public String type() {
      return type;
    }

    @Override
    @JsonProperty("mediaType")
    public String mediaType() {
      return mediaType;
    }

    @Override
    @JsonProperty("url")
    public Optional<String> url() {
      return Optional.ofNullable(url);
    }

    @Override
    @JsonProperty("text")
    public Optional<String> text() {
      return Optional.ofNullable(text);
    }

    @Override
    @JsonProperty("title")
    public Optional<String> title() {
      return Optional.ofNullable(title);
    }

    @Override
    @JsonProperty("placementAdvice")
    public Optional<PlacementAdvice> placementAdvice() {
      return Optional.ofNullable(placementAdvice);
    }

    @Override
    @JsonProperty("expiresAt")
    public Optional<Instant> expiresAt() {
      return Optional.ofNullable(expiresAt);
    }

    @Override
    @JsonProperty("icon")
    public Optional<Image> icon() {
      return Optional.ofNullable(icon);
    }

    @Override
    @JsonProperty("thumbnail")
    public Optional<Image> thumbnail() {
      return Optional.ofNullable(thumbnail);
    }

    @Override
    @JsonProperty("custom")
    public Map<String, String> custom() {
      return custom;
    }

    @Override
    public LtiLinkItem.Builder toBuilder() {
      return LtiLinkItem.builder().mergeFrom(this);
    }

    @Override
    public boolean equals(Object obj) {
      if (!(obj instanceof LtiLinkItem_Builder.Value)) {
        return false;
      }
      LtiLinkItem_Builder.Value other = (LtiLinkItem_Builder.Value) obj;
      return Objects.equals(type, other.type)
          && Objects.equals(mediaType, other.mediaType)
          && Objects.equals(url, other.url)
          && Objects.equals(text, other.text)
          && Objects.equals(title, other.title)
          && Objects.equals(placementAdvice, other.placementAdvice)
          && Objects.equals(expiresAt, other.expiresAt)
          && Objects.equals(icon, other.icon)
          && Objects.equals(thumbnail, other.thumbnail)
          && Objects.equals(custom, other.custom);
    }

    @Override
    public int hashCode() {
      return Objects.hash(
          type, mediaType, url, text, title, placementAdvice, expiresAt, icon, thumbnail, custom);
    }

    @Override
    public String toString() {
      StringBuilder result = new StringBuilder("LtiLinkItem{");
      result.append("type=").append(type);
      result.append(", ");
      result.append("mediaType=").append(mediaType);
      if (url != null) {
        result.append(", ");
        result.append("url=").append(url);
      }
      if (text != null) {
        result.append(", ");
        result.append("text=").append(text);
      }
      if (title != null) {
        result.append(", ");
        result.append("title=").append(title);
      }
      if (placementAdvice != null) {
        result.append(", ");
        result.append("placementAdvice=").append(placementAdvice);
      }
      if (expiresAt != null) {
        result.append(", ");
        result.append("expiresAt=").append(expiresAt);
      }
      if (icon != null) {
        result.append(", ");
        result.append("icon=").append(icon);
      }
      if (thumbnail != null) {
        result.append(", ");
        result.append("thumbnail=").append(thumbnail);
      }
      result.append(", ");
      result.append("custom=").append(custom);
      result.append("}");
      return result.toString();
    }
  }

  private static final class Partial implements LtiLinkItem {
    private final String type;
    private final String mediaType;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final String url;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final String text;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final String title;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final PlacementAdvice placementAdvice;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final Instant expiresAt;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final Image icon;
    // Store a nullable object instead of an Optional. Escape analysis then
    // allows the JVM to optimize away the Optional objects created by our
    // getter method.
    private final Image thumbnail;
    private final Map<String, String> custom;

    Partial(LtiLinkItem_Builder builder) {
      this.type = builder.type;
      this.mediaType = builder.mediaType;
      this.url = builder.url;
      this.text = builder.text;
      this.title = builder.title;
      this.placementAdvice = builder.placementAdvice;
      this.expiresAt = builder.expiresAt;
      this.icon = builder.icon;
      this.thumbnail = builder.thumbnail;
      this.custom = immutableMap(builder.custom);
    }

    @Override
    @JsonProperty("@type")
    public String type() {
      return type;
    }

    @Override
    @JsonProperty("mediaType")
    public String mediaType() {
      return mediaType;
    }

    @Override
    @JsonProperty("url")
    public Optional<String> url() {
      return Optional.ofNullable(url);
    }

    @Override
    @JsonProperty("text")
    public Optional<String> text() {
      return Optional.ofNullable(text);
    }

    @Override
    @JsonProperty("title")
    public Optional<String> title() {
      return Optional.ofNullable(title);
    }

    @Override
    @JsonProperty("placementAdvice")
    public Optional<PlacementAdvice> placementAdvice() {
      return Optional.ofNullable(placementAdvice);
    }

    @Override
    @JsonProperty("expiresAt")
    public Optional<Instant> expiresAt() {
      return Optional.ofNullable(expiresAt);
    }

    @Override
    @JsonProperty("icon")
    public Optional<Image> icon() {
      return Optional.ofNullable(icon);
    }

    @Override
    @JsonProperty("thumbnail")
    public Optional<Image> thumbnail() {
      return Optional.ofNullable(thumbnail);
    }

    @Override
    @JsonProperty("custom")
    public Map<String, String> custom() {
      return custom;
    }

    private static class PartialBuilder extends LtiLinkItem.Builder {
      @Override
      public LtiLinkItem build() {
        return buildPartial();
      }
    }

    @Override
    public LtiLinkItem.Builder toBuilder() {
      LtiLinkItem.Builder builder = new PartialBuilder();
      builder.type(type);
      builder.mediaType(mediaType);
      builder.nullableUrl(url);
      builder.nullableText(text);
      builder.nullableTitle(title);
      builder.nullablePlacementAdvice(placementAdvice);
      builder.nullableExpiresAt(expiresAt);
      builder.nullableIcon(icon);
      builder.nullableThumbnail(thumbnail);
      builder.putAllCustom(custom);
      return builder;
    }

    @Override
    public boolean equals(Object obj) {
      if (!(obj instanceof LtiLinkItem_Builder.Partial)) {
        return false;
      }
      LtiLinkItem_Builder.Partial other = (LtiLinkItem_Builder.Partial) obj;
      return Objects.equals(type, other.type)
          && Objects.equals(mediaType, other.mediaType)
          && Objects.equals(url, other.url)
          && Objects.equals(text, other.text)
          && Objects.equals(title, other.title)
          && Objects.equals(placementAdvice, other.placementAdvice)
          && Objects.equals(expiresAt, other.expiresAt)
          && Objects.equals(icon, other.icon)
          && Objects.equals(thumbnail, other.thumbnail)
          && Objects.equals(custom, other.custom);
    }

    @Override
    public int hashCode() {
      return Objects.hash(
          type, mediaType, url, text, title, placementAdvice, expiresAt, icon, thumbnail, custom);
    }

    @Override
    public String toString() {
      StringBuilder result = new StringBuilder("partial LtiLinkItem{");
      result.append("type=").append(type);
      result.append(", ");
      result.append("mediaType=").append(mediaType);
      if (url != null) {
        result.append(", ");
        result.append("url=").append(url);
      }
      if (text != null) {
        result.append(", ");
        result.append("text=").append(text);
      }
      if (title != null) {
        result.append(", ");
        result.append("title=").append(title);
      }
      if (placementAdvice != null) {
        result.append(", ");
        result.append("placementAdvice=").append(placementAdvice);
      }
      if (expiresAt != null) {
        result.append(", ");
        result.append("expiresAt=").append(expiresAt);
      }
      if (icon != null) {
        result.append(", ");
        result.append("icon=").append(icon);
      }
      if (thumbnail != null) {
        result.append(", ");
        result.append("thumbnail=").append(thumbnail);
      }
      result.append(", ");
      result.append("custom=").append(custom);
      result.append("}");
      return result.toString();
    }
  }

  private static <K, V> Map<K, V> immutableMap(Map<K, V> entries) {
    switch (entries.size()) {
      case 0:
        return Collections.emptyMap();
      case 1:
        Map.Entry<K, V> entry = entries.entrySet().iterator().next();
        return Collections.singletonMap(entry.getKey(), entry.getValue());
      default:
        return Collections.unmodifiableMap(new LinkedHashMap<>(entries));
    }
  }
}
